<section id="section-{{ section.id }}" class="custom-video-section-main">
    <div class="custom-video-section Container">
      {% if section.settings.heading != blank %}
        <h2 class="SectionHeader__Heading Heading u-h1">{{ section.settings.heading }}</h2>
      {% endif %}
      <div class="custom-video-section__grid">
        {% for block in section.blocks %}
        <div class="custom-video-section__item"> 
        {% assign mp4_video = block.settings.video %}
        {% assign video_url = block.settings.video_url %}  
        {% if block.settings.heading != blank %}
          <h3 class="custom-video-section__title">{{ block.settings.heading }}</h3>
        {% endif %}
        <div class="custom-video-section__video-wrapper">
          {% if block.settings.thumbnail != blank %}
            <div class="custom-video-section__thumbnail-wrapper">
              <img src="{{ block.settings.thumbnail | image_url: width: 800 }}" loading="lazy" class="custom-video-section__thumbnail" alt="Video thumbnail">
              <button class="custom-video-section__play-button" aria-label="Play video"
                data-mp4="{{ block.settings.video.sources[1].url }}"
                data-youtube="{{ video_url.id }}"
                data-type="{% if mp4_video != blank %}mp4{% else %}youtube{% endif %}">
                <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" class="icon icon-play" fill="none" viewBox="0 0 10 14">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M1.48177 0.814643C0.81532 0.448245 0 0.930414 0 1.69094V12.2081C0 12.991 0.858787 13.4702 1.52503 13.0592L10.5398 7.49813C11.1918 7.09588 11.1679 6.13985 10.4965 5.77075L1.48177 0.814643Z" fill="currentColor"></path>
                </svg>
              </button>
            </div>
          {% else %}
            {% if mp4_video != blank %}
              {{
                mp4_video
                | video_tag:
                image_size: '1100x',
                autoplay: true,
                loop: true,
                controls: true,
                muted: true
                }}
            {% elsif video_url != blank %}
              <iframe
                src="https://www.youtube.com/embed/{{ video_url.id }}?enablejsapi=1&autoplay=1"
                class="js-youtube"
                allow="autoplay; encrypted-media"
                allowfullscreen
                title="{{ block.settings.heading | escape }}"
                height="350"
              ></iframe>
            {% endif %}
          {% endif %}
        </div>        
      </div>
    {% endfor %}
    </div>
    {% if section.settings.button_label != blank and section.settings.button_link != blank %}
      <div class="custom-video-section__button">
        <a href="{{ section.settings.button_link }}" class="Button Button--primary button__alt">{{ section.settings.button_label }}</a>
      </div>
    {% endif %}
  </div>
</section>      
<style>
  #section-{{ section.id }} {
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }
  #section-{{ section.id }} .SectionHeader__Heading,
  #section-{{ section.id }} .custom-video-section__title {
    color: {{ section.settings.text_color }};
  }  
  #section-{{ section.id }} .play-icon path {
    fill: {{ section.settings.text_color }};
  }
  @media (min-width: 768px) {
    #section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top_desktop }}px;
      padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".custom-video-section__play-button").forEach(button => {
      button.addEventListener("click", function () {
        const wrapper = button.closest(".custom-video-section__video-wrapper");
        const mp4 = button.getAttribute("data-mp4");
        const youtubeId = button.getAttribute("data-youtube");
        const type = button.getAttribute("data-type");
  
        wrapper.innerHTML = "";
  
        if (type === "mp4" && mp4) {
          const video = document.createElement("video");
          video.setAttribute("src", mp4);
          video.setAttribute("controls", "true");
          video.setAttribute("autoplay", "true");
          video.setAttribute("loop", "true");
          video.setAttribute("muted", "true");
          video.setAttribute("playsinline", "true");
          video.style.width = "100%";
          wrapper.appendChild(video);
        } else if (type === "youtube" && youtubeId) {
          const iframe = document.createElement("iframe");
          iframe.setAttribute("src", `https://www.youtube.com/embed/${youtubeId}?autoplay=1&enablejsapi=1`);
          iframe.setAttribute("class", "js-youtube");
          iframe.setAttribute("allow", "autoplay; encrypted-media");
          iframe.setAttribute("allowfullscreen", "true");
          iframe.setAttribute("height", "350");
          iframe.style.width = "100%";
          wrapper.appendChild(iframe);
        }
      });
    });
  });
</script>



{% schema %}
{
  "name": "Custom Video Testimonials",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Top Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Bottom Padding (Mobile)",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "label": "Top Padding (Desktop)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "label": "Bottom Padding (Desktop)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "video_block",
      "name": "Video Block",
      "settings": [
        {
          "type": "header",
          "content": "Video Block"
        },
        {
          "type":"header",
          "content":"MP4 Video"
        },
        {
          "type":"video",
          "id":"video",
          "label":"Video"
        },
        {
          "type":"header",
          "content":"YouTube/Vimeo Video"
        },
        {
          "type": "video_url",
          "id": "video_url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "label": "Youtube & Vimeo video"
        },
        {
          "type": "image_picker",
          "id": "thumbnail",
          "label": "Thumbnail Image"
        },
        {
          "type": "header",
          "content": "Content Block"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Video Heading"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Video Testimonials",
      "blocks": [
        {
          "type": "video_block"
        },
        {
          "type": "video_block"
        }
      ]
    }
  ]
}
{% endschema %}
