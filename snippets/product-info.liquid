{{ 'product-customize.css' | asset_url | stylesheet_tag }}
{% capture title_and_price %}
{%- for block in section.blocks -%}
  {%- case block.type -%}
    {% when 'product_meta' %}
    {%- render 'product-meta', form: form, block: block, product: product -%}
    <div class="desktop-hide">
      <div class="loox-rating" data-id="{{ product.id }}" data-rating="{{ product.metafields.loox.avg_rating }}" data-raters="{{ product.metafields.loox.num_reviews }}"></div>
    </div>
  {% endcase %}
{% endfor %}
{% endcapture %}
{% capture title_and_price_mobile %}
{%- for block in section.blocks -%}
  {%- case block.type -%}
    {% when 'product_meta' %}
    {%- render 'product-meta-mobile', form: form, block: block, product: product -%}
    <div class="desktop-hide">
      <div class="loox-rating" data-id="{{ product.id }}" data-rating="{{ product.metafields.loox.avg_rating }}" data-raters="{{ product.metafields.loox.num_reviews }}"></div>
    </div>
  {% endcase %}
{% endfor %}
{% endcapture %}

  <div class="Product__Info_customize">
    {% comment %} <div class="Container"> {% endcomment %}
      {%- assign has_ouputted_variant_selector = false -%}

        {%- form 'product'
          , product
          , class: 'ProductForm'
          , id: 'js-add-to-cart' -%}
        {%- render 'product-data'
          , product: product -%}

        {% assign app_blocks = section.blocks | where: 'type', '@app' %}
          {% assign fit_guide_block = app_blocks[0] %}
          {% assign second_app_block = app_blocks[1] %} 

        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'product_meta' -%}
              <div class="mobile-hide">
                {{ title_and_price }}
              </div>

              <div
                hook-widget-count="{{ product.id }}"
                class="sold-count-widget"
                data-counter="{{ product.metafields['app--71373979649--soldcount'].counter }}"
                data-resent="{{ product.metafields['app--71373979649--soldcount'].customer }}"></div>

            {%- when 'share_buttons' -%}
              <div class="ProductMeta__ShareButtons hidden-pocket" {{ block.shopify_attributes }}>
                <span class="ProductMeta__ShareTitle Heading Text--subdued u-h7">{{ 'product.form.share' | t }}</span>

                {%- assign share_url = shop.url | append: product.url -%}
                {%- assign twitter_text = product.title -%}
                {%- assign pinterest_description = product.description | strip_html | truncatewords: 15 | url_param_escape -%}
                {%- assign pinterest_image = product.featured_image | img_url: 'large' | prepend: 'https:' -%}

                <div class="ProductMeta__ShareList Text--subdued">
                  <a
                    class="ProductMeta__ShareItem"
                    href="https://www.facebook.com/sharer.php?u={{ share_url }}"
                    target="_blank"
                    rel="noopener"
                    aria-label="Facebook">{%- render 'icon' with 'facebook' -%}</a>
                  <a
                    class="ProductMeta__ShareItem"
                    href="https://twitter.com/share?{% if twitter_text != blank %}text={{twitter_text}}&{% endif %}url={{ share_url }}"
                    target="_blank"
                    rel="noopener"
                    aria-label="Twitter">{%- render 'icon' with 'twitter' -%}</a>
                  <a
                    class="ProductMeta__ShareItem"
                    href="https://pinterest.com/pin/create/button/?url={{ share_url }}{% if pinterest_image != blank %}&media={{ pinterest_image }}{% endif %}&description={{ pinterest_description }}"
                    target="_blank"
                    rel="noopener"
                    aria-label="Pinterest">{%- render 'icon' with 'pinterest' -%}</a>
                </div>
              </div>

            {%- when 'variant_selector' -%}
              {% assign selected_variant = nil %}
              {% if product.has_only_default_variant == false %}
                <div class="variants-container">
                  {% assign size_option = nil %}
                  {% assign color_option = product.options_with_values[0] %}
                  {% assign size_option = product.options_with_values[1] %}

                  {% comment %} 2 variants {% endcomment %}
                  {% if product.options.size >= 2 %}
                    <div id="2-variant-existed">
                      {% assign selected_variant = product.selected_or_first_available_variant %}
                      {% assign selected_color = nil %}
                      <div id="after-select-color">{{ product.options_with_values[0].name }}:
                        <span id="option-value-color">{{ selected_variant.option1 }}</span>
                      </div>
                      <div class="color-size-variant-container">
                        {% for color_value in color_option.values %}
                          {% assign swatch_image = nil %}
                          {% assign swatch_variant = nil %}

                          {%- for variant in product.variants -%}

                            {%- if variant.option1 == color_value and variant.image -%}
                              {% assign swatch_image = variant.featured_media %}
                              {% assign swatch_variant = variant %}
                              {% assign variant_gallery = variant.metafields.custom.variant_gallery.value %}
                              {% capture variant_gallery_json %}
                                    [
                                      {%- for media in variant_gallery -%}
                                        {
                                          "id": {{ media.id | json }},
                                          "alt": {{ media.alt | json }},
                                          "src": {{ media | image_url: width: 1200, height: 1200, crop: 'center' | json }}
                                        }{% unless forloop.last %},{% endunless %}
                                      {%- endfor -%}
                                    ]
                                  {% endcapture %}
                              {% break %}
                            {%- endif -%}
                          {%- endfor -%}

                          {% if swatch_image %}
                            {% assign selected_color = selected_variant.option1 %}
                            {% assign active_class = '' %}
                            {% if color_value == selected_color %}
                              {% assign active_class = ' active' %}
                            {% endif %}
                            {% assign img_class = 'variant-image' | append: active_class %}
                            <div class="variant-image-container-color" data-product-option>
                              {{ swatch_image
 | image_url: width: 200, height: 200, crop: 'center'
 | image_tag:
 loading: 'eager',
 alt: swatch_variant.option1,
 class: img_class,
 data_url: swatch_variant.url,
 data_option_name: product.options[0],
 data_option_value: color_value,
 data_option_position: color_option.position,
 data_id: swatch_variant.id,
 data_media_id: swatch_image.id,
 data_variant_gallery: variant_gallery_json }}
                              <div class="title">
                                {% comment %} {{ color_value }} {% endcomment %}
                              </div>
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>

                      {% comment %} SIZE after select {% endcomment %}
                      <div id="after-select-size">{{ product.options_with_values[1].name }}:
                        <span id="option-value-size"></span>
                        {% if fit_guide_block %}
                          <div class="fit-guide-slot">
                            {% render fit_guide_block %}
                          </div>
                        {% endif %}
                      </div>

                      <div class="variant-size" data-product-option>
                        {% for variant in product.variants %}
                          {% if variant.option1 == selected_color %}
                            {% assign size = variant.option2 %}
                            {% assign sizeAvailable = variant.available %}

                            <div
                              class="title-size{% if sizeAvailable == false %} not-available{% endif %}"
                              data-size="{{ size }}"
                              data-product-option
                              data-option-position="{{ size_option.position }}"
                              data-option-name="{{ product.options[1] }}"
                              data-option-value="{{ size | escape }}"
                              data-id="{{ size }}">
                              {{ size }}
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </div>


                  {% comment %} 1 variant ONLY {% endcomment %}
                  {% else %}
                    {% assign variant_image_exist = nil %}
                    {% for variant in product.variants %}
                      {% if product.first_available_variant %}
                        {% assign selected_variant = product.selected_or_first_available_variant %}
                      {% endif %}

                      {% assign color = variant.option1 %}
                      {% assign color_option = product.options_with_values[0] %}
                      {% if variant.featured_media and color_option.name != 'Size' %}
                        {% assign variant_image_exist = true %}
                      {% endif %}
                    {% endfor %}

                    <div id="one-option-only">
                      {% if variant_image_exist %}
                        <div id="after-select-size">
                          {{ product.options_with_values[0].name }}:
                          <span id="option-value-color"></span>

                          {% if fit_guide_block %}
                            <div class="fit-guide-slot">
                              {% render fit_guide_block %}
                            </div>
                          {% endif %}
                        </div>

                        <div class="color-size-variant-container">
                          {% for color_value in color_option.values %}
                            {%- for variant in product.variants -%}

                              {%- if variant.option1 == color_value and variant.image -%}
                                {% assign swatch_image = variant.featured_media %}
                                {% assign swatch_variant = variant %}
                                {% assign variant_gallery = variant.metafields.custom.variant_gallery.value %}
                                {% capture variant_gallery_json %}
                                    [
                                      {%- for media in variant_gallery -%}
                                        {
                                          "id": {{ media.id | json }},
                                          "alt": {{ media.alt | json }},
                                          "src": {{ media | image_url: width: 1600, height: 1600, crop: 'center' | json }}
                                        }{% unless forloop.last %},{% endunless %}
                                      {%- endfor -%}
                                    ]
                                  {% endcapture %}
                                {% break %}
                              {%- endif -%}
                            {%- endfor -%}
                            {% assign media = swatch_image %}
                            <div class="variant-image-container-color" data-product-option>
                              {% assign variant_image_classes = 'variant-image' %}
                              {% for variant in product.variants %}
                                {% if variant.option1 == color_value and variant.id == swatch_variant.id and variant.available == false %}
                                  {% assign variant_image_classes = variant_image_classes | append: ' variant-image--sold-out' %}
                                {% endif %}
                              {% endfor %}
                              {{ media
 | image_url: width: 200, height: 200, crop: 'center' 
 | image_tag: loading: 'eager', alt: swatch_variant.title, 
 class: variant_image_classes,
 data-url: swatch_variant.url,
 data_option_value: color_value, 
 data_option_name: product.options[0],
 data_option_position: variant.options_positions[0], 
 data_id: variant.id,
 data_media_id: media.id, 
 data_variant_gallery: variant_gallery_json }}
                            </div>
                          {% endfor %}
                        </div>

                      {% else %}
                        <div id="after-select-size">{{ product.options_with_values[0].name }}:
                          <span id="option-value-size"></span>
                          {% if fit_guide_block %}
                            <div class="fit-guide-slot">
                              {% render fit_guide_block %}
                            </div>
                          {% endif %}
                        </div>

                        <div class="variant-size" data-product-option>
                          {% for variant in product.variants %}
                            {% assign sizeAvailable = variant.available %}
                            <div
                              class="title-size{% if product.options[0] contains 'Color' or product.options[0] contains 'Colour' %} variant-image{% endif %}
                                  {% if sizeAvailable == false %} not-available{% endif %}"
                              data-option-name="{{ product.options[0] }}"
                              data-option-value="{{ variant.title }}"
                              data_id="{{ variant.id }}"
                              data-product-option>
                              {{ variant.title }}
                            </div>
                          {% endfor %}
                        </div>
                      {% endif %}
                    </div>
                  {% endif %}

                  <input type="hidden" name="id">
                </div>
              {% else %}
                <div id="do-not-have-variant"></div>
                <input type="hidden" name="id">
              {% endif %}

            {%- when '@app' -%}
              {% if second_app_block.id == "AeVB1cVhBMXBJYmpPM__248761ef-195f-4af1-a06e-335455fc1da2" %}
                {% render second_app_block %}
              {% endif %}

            {%- when 'quantity_selector' -%}
              <div class="ProductForm__QuantitySelector" {{ block.shopify_attributes }}>
                {%- if block.settings.show_label -%}
                  <span class="ProductForm__Label">{{ 'product.form.quantity' | t }}:</span>
                {%- endif -%}

                <div class="QuantitySelector QuantitySelector--large">
                  {%- assign quantity_minus_one = line_item.quantity | minus: 1 -%}

                  <button
                    type="button"
                    class="QuantitySelector__Button Link Link--secondary"
                    data-action="decrease-quantity">{% render 'icon' with 'minus' %}</button>
                  <input
                    type="text"
                    class="QuantitySelector__CurrentQuantity"
                    pattern="[0-9]*"
                    name="quantity"
                    value="1"
                    aria-label="{{ 'product.form.quantity' | t }}">
                  <button
                    type="button"
                    class="QuantitySelector__Button Link Link--secondary"
                    data-action="increase-quantity">{% render 'icon' with 'plus' %}</button>
                </div>

              {%- when 'inventory' -%}
                {%- assign hide_inventory_quantity_by_default = false -%}

                {%- if product.selected_or_first_available_variant.inventory_management == blank or product.selected_or_first_available_variant.inventory_quantity <= 0 -%}
                  {%- assign hide_inventory_quantity_by_default = true -%}
                {%- endif -%}

                {%- if block.settings.inventory_quantity_threshold != 0 and product.selected_or_first_available_variant.inventory_quantity > block.settings.inventory_quantity_threshold -%}
                  {%- assign hide_inventory_quantity_by_default = true -%}
                {%- endif -%}

                <p
                  class="ProductForm__Inventory Text--subdued"
                  {% if hide_inventory_quantity_by_default %}
                  style="display: none"
                  {% endif %}
                  {{ block.shopify_attributes }}>
                  {%- if block.settings.inventory_quantity_threshold == 0 -%}
                    {{- 'product.form.inventory_quantity_count' | t: count: product.selected_or_first_available_variant.inventory_quantity -}}
                  {%- else -%}
                    {{- 'product.form.low_inventory_quantity_count' | t: count: product.selected_or_first_available_variant.inventory_quantity -}}
                  {%- endif -%}
                </p>

              {%- when 'buy_buttons' -%}
                {%- if block.settings.show_payment_button == false or product.selling_plan_groups.size > 0 -%}
                  {%- assign use_primary_button = true -%}
                {%- else -%}
                  {%- assign use_primary_button = false -%}
                {%- endif -%}

                <div class="ProductForm__BuyButtons" {{ block.shopify_attributes }}>
                  {%- if block.settings.show_payment_button and product.selected_or_first_available_variant.available == false -%}
                    <style>
                      #shopify-section-{{ section.id }} .shopify-payment-button {
                        display: none;
                      }
                    </style>
                  {%- endif -%}

                  <button
                    type="submit"
                    data-use-primary-button="{% if use_primary_button %}true{% else %}false{% endif %}"
                    data-action="add-to-cart"
                    class="ProductForm__AddToCart"
                    aria-disabled="false"
                    id="add-to-cart-button"
                    name="add"
                    disabled>
                    {%- if product.selected_or_first_available_variant.available -%}
                      <span>
                        {% if product.template_suffix == 'pre-order' %}
                          {{ 'product.form.pre_order' | t }}
                        {% else %}
                          {{ 'product.form.add_to_cart' | t }}
                        {% endif %}
                      </span>

                      {%- if block.settings.show_price_in_button -%}
                        <span class="Button__SeparatorDot"></span>
                        <span>{{ product.selected_or_first_available_variant.price | money }}</span>
                      {%- endif -%}

                    {%- else -%}
                      {{- 'product.form.sold_out' | t -}}
                    {%- endif -%}
                  </button>

                  {%- if block.settings.show_payment_button and product.template_suffix != 'pre-order' -%}
                    {{ form | payment_button }}
                  {%- endif -%}
                </div>
         

            {% comment %} description {% endcomment %}
            {%- when 'description' -%}
              {%- if product.description != blank -%}
                <div class="ProductMeta__Description" {{ block.shopify_attributes }}>
                  <div class="Rte">
                    {{- product.description | replace: 'data-section-type', 'data-section-type-placeholder' -}}
                  </div>
                </div>
              {%- endif -%}
              <div class="desktop_product_tabs">
                {% render 'dynamic-tabs' %}
              </div>

            {%- when 'store_pickup' -%}
              {%- comment -%}The availability container will be added automatically if there is store pickup available{%- endcomment -%}
              <div class="ProductMeta__StoreAvailabilityContainer" {{ block.shopify_attributes }}></div>

            {%- when 'text' -%}
              {%- if block.settings.text != blank -%}
                <div class="ProductMeta__Text" {{ block.shopify_attributes }}>
                  {{- block.settings.text -}}
                </div>
              {%- endif -%}

            {%- when 'liquid' -%}
              {%- if block.settings.liquid != blank -%}
                <div class="ProductMeta__Text" {{ block.shopify_attributes }}>
                  {{ block.settings.liquid }}
                </div>
              {%- endif -%}

          {%- endcase -%}
        {%- endfor -%}

        {%- unless has_ouputted_variant_selector -%}
          {%- comment -%}If for any reason the merchant has removed the variant selector block, we still output the ID here{%- endcomment -%}

        {%- endunless -%}
      {%- endform -%}

      {%- if section.settings.stack_images and product_aside != blank and media_count > 0 -%}
        <div class="Product__QuickNav hidden-pocket">
          <div class="Product__QuickNavWrapper">
            <a href="#ProductAside" class="Heading Link Link--secondary u-h7">{{ 'product.form.view_info' | t }} {% render 'icon' with 'select-arrow-right' %}</a>
            <a href="#ProductGallery" class="Heading Link Link--secondary u-h7">{{ 'product.form.view_images' | t }} {% render 'icon' with 'select-arrow-right' %}</a>
          </div>
        </div>
      {%- endif -%}
    {% comment %} </div> {% endcomment %}
  </div>
